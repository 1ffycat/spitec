stages:
    - deploy
    
deploy:
  stage: deploy
  script:
    - |
      if [ ! -d "./tmp" ]; then
        mkdir tmp;
      fi
    - |
      if [ -f "./tmp/gunicorn.pid" ]; then
        kill -9 $(cat ./tmp/gunicorn.pid);
      fi
    - poetry install
    - nohup poetry run gunicorn -w 4 -b 0.0.0.0:8050 --pid ./tmp/gunicorn.pid main:server >./tmp/log.txt 2>&1 &
    - exit 0
  only:
    - main